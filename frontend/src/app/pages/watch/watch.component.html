<main id="main-content">
  <app-video-watch-panel [videoId]="videoId"></app-video-watch-panel>
  
  <div id="info-panel" [class.collapsed]="commentSectionCollapsed">
    <div class="collapse-btn-wrapper">
      <button id="collapse-btn" (click)="toggleCommentSectionPanel()">
        @if (commentSectionCollapsed) {
          <span>Show Comments</span>
        } @else {
          <span class="hide-comments">Hide Comments</span>
        }
      </button>
    </div>
    @if (!commentSectionCollapsed) {
      <div class="comments-section">
        <div class="comment-form">
          <div class="form-group new-comment-info">
            <div class="channel-avatar channel-redirect" (click)="navigateToChannel(mockChannel.id, mockChannel.uuid)">
              <img [src]="mockChannel.picture" [alt]="mockChannel.name">
            </div>
            <div class="channel-name channel-redirect">
              <span (click)="navigateToChannel(mockChannel.id, mockChannel.uuid)">{{ mockChannel.name }}</span>
              @if (mockChannel.verified) {
                <i class="material-icons verified">verified</i>
              }
            </div>
          </div>
          <div class="form-group">
            <textarea [(ngModel)]="newCommentContent" placeholder="Write a comment..." class="comment-input"></textarea>
          </div>
          <button (click)="addComment()" class="submit-button" [disabled]="!newCommentContent.trim() || !videoCommentsLoaded">Post Comment</button>
        </div>

        @if (videoCommentsLoaded) {
          <div class="comments-header">
            <h3>{{ comments.length }} Comments</h3>
            <div class="sort-options">
              <button class="sort-button active">Newest</button>
              <button class="sort-button">Top</button>
            </div>
          </div>
        }

        @if (videoCommentsLoaded) {
          <div class="comments-list">
            @for (comment of comments; track comment.id) {
              <div class="comment-item">
                <div class="comment-header">
                  <div class="comment-author">
                    <div class="channel-avatar channel-redirect" (click)="navigateToChannel(comment.channel.id, comment.channel.uuid)">
                      <img [src]="comment.channel.picture" [alt]="comment.channel.name">
                    </div>
                    <span class="author-name channel-redirect" (click)="navigateToChannel(comment.channel.id, comment.channel.uuid)">{{ comment.channel.name }}</span>
                    @if (comment.channel.verified) {
                      <i class="material-icons verified">verified</i>
                    }
                    <span class="comment-timestamp dot">â€¢</span>
                    <span class="comment-timestamp">{{ comment.createdAt | formatDate }}</span>
                  </div>
                  <div class="comment-actions">
                    <button class="action-button">
                      <i class="material-icons">thumb_up</i>
                      <span>{{ comment.likes }}</span>
                    </button>
                    <button class="action-button">
                      <i class="material-icons">thumb_down</i>
                      <span>{{ comment.dislikes }}</span>
                    </button>
                    <button class="action-button">
                      <i class="material-icons">reply</i>
                    </button>
                  </div>
                </div>
                <div class="comment-content">
                  {{ comment.content }}
                </div>
                <app-comment-replies [commentId]="comment.id" [repliesAmount]="comment.repliesAmount"></app-comment-replies>
              </div>
            }
          </div>
        }
      </div>
    }
  </div>

  <div class="side-section-overlay">
    <div #sideSection id="side-section">
      <div class="carousel-overlay"></div>
      <div class="related-carousel">
        <div class="carousel-title">Related Videos</div>
        <div class="carousel-list">
          @for (related of relatedVideos; track related.id) {
            <app-related-video [video]="related"></app-related-video>
          }
        </div>
      </div>
    </div>
  </div>
</main>
